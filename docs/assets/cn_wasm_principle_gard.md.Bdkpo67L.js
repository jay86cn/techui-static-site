import{_ as e,c as o,o as a,aj as r}from"./chunks/framework.DPdjieCD.js";const p=JSON.parse('{"title":"守卫验证","description":"","frontmatter":{},"headers":[],"relativePath":"cn/wasm/principle/gard.md","filePath":"cn/wasm/principle/gard.md"}'),n={name:"cn/wasm/principle/gard.md"};function d(i,t,l,c,s,h){return a(),o("div",null,[...t[0]||(t[0]=[r('<h1 id="守卫验证" tabindex="-1">守卫验证 <a class="header-anchor" href="#守卫验证" aria-label="Permalink to &quot;守卫验证&quot;">​</a></h1><p><strong>守卫 (Wasm Guard)</strong> 是运行在 TechUI Wasm 核心中的一套主动监测子系统。</p><p>如果说“防篡改”是系统的被动防御底线，那么“守卫验证”则是系统的主动合规检查。它负责在运行时高频地校验当前环境是否满足许可证定义的各项约束，确保组件在合法、安全的状态下运行。</p><h2 id="许可证合规监测" tabindex="-1">许可证合规监测 <a class="header-anchor" href="#许可证合规监测" aria-label="Permalink to &quot;许可证合规监测&quot;">​</a></h2><p>守卫会严格根据您配置的许可证参数（参见 [解密流程] 章节），对当前运行环境进行逐项比对。</p><h3 id="📅-有效期检查-expiration" tabindex="-1">📅 有效期检查 (Expiration) <a class="header-anchor" href="#📅-有效期检查-expiration" aria-label="Permalink to &quot;📅 有效期检查 (Expiration)&quot;">​</a></h3><p>守卫对有效期的校验策略取决于许可证的类型：</p><ul><li><strong>正式许可证</strong>：对于 <strong>项目 / 公司 / 商业</strong> 等正式许可证，其 <code>expDate</code> 默认为 <code>endless</code>（永久）。守卫<strong>不会</strong>对正式许可证进行过期阻断。</li><li><strong>开发许可证</strong>：这是<strong>唯一</strong>具有强制截止日期的许可证类型。守卫会校验当前系统时间是否超过了开发许可证定义的结束时间。一旦过期，组件将停止运行，提示您购买正式授权。</li><li><strong>临时体验 Key</strong>：当免费版用户使用“临时 Key”解锁高级组件时，守卫会开启倒计时监测。一旦超时，组件将自动熔断或降级回免费状态。</li></ul><h3 id="🔒-项目名称锁定-project-title-lock" tabindex="-1">🔒 项目名称锁定 (Project Title Lock) <a class="header-anchor" href="#🔒-项目名称锁定-project-title-lock" aria-label="Permalink to &quot;🔒 项目名称锁定 (Project Title Lock)&quot;">​</a></h3><p>当许可证开启了 <strong>项目绑定</strong> 时，守卫将启动严格的标题监测机制：</p><ul><li><strong>一致性检查</strong>：检测浏览器标题 <code>document.title</code> 是否包含了许可证中指定的 <code>project</code> 名称。</li><li><strong>劫持对抗</strong>：为了防止恶意代码通过 <code>Object.defineProperty</code> 劫持 <code>document.title</code> 属性来欺骗检查，守卫会检测该属性的描述符（Descriptor）。</li><li><em>注意：正常的业务代码不需要重写标题属性的 Setter/Getter。一旦检测到非原生的属性定义，将被视为攻击。</em></li></ul><h3 id="🌐-域名-环境绑定-domain-binding" tabindex="-1">🌐 域名/环境绑定 (Domain Binding) <a class="header-anchor" href="#🌐-域名-环境绑定-domain-binding" aria-label="Permalink to &quot;🌐 域名/环境绑定 (Domain Binding)&quot;">​</a></h3><ul><li><strong>逻辑</strong>：如果许可证配置了 <code>domainBind</code> 或 <code>localOnly</code>，守卫会校验 <code>window.location.hostname</code>。</li><li><strong>场景</strong>：主要用于限制“本地化部署”的授权不被非法部署到公网环境。</li></ul><h2 id="运行时完整性检查" tabindex="-1">运行时完整性检查 <a class="header-anchor" href="#运行时完整性检查" aria-label="Permalink to &quot;运行时完整性检查&quot;">​</a></h2><p>除了校验许可证，守卫还需要确保自身的运行基座（浏览器环境）未被破坏。</p><h3 id="🧬-原生方法完整性" tabindex="-1">🧬 原生方法完整性 <a class="header-anchor" href="#🧬-原生方法完整性" aria-label="Permalink to &quot;🧬 原生方法完整性&quot;">​</a></h3><p>TechUI 的 Wasm 模块依赖部分浏览器原生 API 进行通信与渲染。守卫在启动时及运行中会检测这些关键方法是否被第三方脚本篡改或 Hook。</p><ul><li><strong>监测对象</strong>：包括但不限于 <code>console</code> 系列方法、<code>setTimeout/setInterval</code> 定时器、<code>fetch</code> 请求方法等。</li><li><strong>判定标准</strong>：检测这些函数是否为 <code>[native code]</code>，防止被恶意代码注入钩子（Hook）以拦截或伪造数据。</li></ul><h3 id="📝-签名完整性" tabindex="-1">📝 签名完整性 <a class="header-anchor" href="#📝-签名完整性" aria-label="Permalink to &quot;📝 签名完整性&quot;">​</a></h3><ul><li><strong>逻辑</strong>：TechUI 会在 DOM 结构的特定位置（如 <code>&lt;head&gt;</code> 或 <code>&lt;body&gt;</code> 的尾部）注入包含授权摘要的注释节点。</li><li><strong>监测</strong>：守卫会轮询检查该签名节点是否存在。人为移除该节点将被视为破坏知识产权展示，触发熔断。</li></ul><h2 id="触发机制" tabindex="-1">触发机制 <a class="header-anchor" href="#触发机制" aria-label="Permalink to &quot;触发机制&quot;">​</a></h2><p>守卫验证并非时刻占用主线程资源，而是采用“事件驱动 + 低频轮询”的混合策略。</p><table tabindex="0"><thead><tr><th>触发方式</th><th>说明</th><th>频率</th></tr></thead><tbody><tr><td><strong>初始化自检</strong></td><td>组件加载时的首次全量检查。</td><td>1 次 / 生命周期</td></tr><tr><td><strong>高级调用</strong></td><td>当代码调用高级组件（如 3D 场景）时触发。</td><td>按需触发</td></tr><tr><td><strong>心跳轮询</strong></td><td>利用 Wasm 内部定时器进行的低频状态确认。</td><td>极低频（对性能无影响）</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">⚠️ 开发者注意</p><p>为了避免触发误报，请勿在您的业务代码中<strong>重写（Override）</strong> 浏览器的原生对象方法（如 <code>Date</code>, <code>setTimeout</code>），或使用黑客手段劫持 DOM 属性。这些行为可能会被守卫误判为环境不安全。</p></div>',24)])])}const u=e(n,[["render",d]]);export{p as __pageData,u as default};
