import{_ as i,c as a,o as n,aj as t}from"./chunks/framework.DPdjieCD.js";const c=JSON.parse('{"title":"初始化配置","description":"","frontmatter":{},"headers":[],"relativePath":"cn/i18n/start/initialization.md","filePath":"cn/i18n/start/initialization.md"}'),l={name:"cn/i18n/start/initialization.md"};function e(h,s,p,k,o,r){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="初始化配置" tabindex="-1">初始化配置 <a class="header-anchor" href="#初始化配置" aria-label="Permalink to &quot;初始化配置&quot;">​</a></h1><p>TechUI 的多语言系统依赖于全局服务 <code>TuiService</code> 进行初始化。在大多数情况下，您无需手动编写复杂的加载逻辑，系统会自动根据环境适配最合适的语言包。</p><h2 id="自动初始化" tabindex="-1">自动初始化 <a class="header-anchor" href="#自动初始化" aria-label="Permalink to &quot;自动初始化&quot;">​</a></h2><p>当应用启动并调用 <code>TechUIInit</code> 时，内部会自动执行 <code>initI18n</code> 方法。该方法的默认行为流程如下：</p><ol><li><strong>侦测语言</strong>：调用 <code>getSysLang()</code> 获取当前环境的目标语言（例如 <code>&#39;cn&#39;</code>）。此函数会优先读取本地存储中的配置，若无则读取浏览器环境语言。</li><li><strong>检查缓存</strong>：通过 <code>tLang.load()</code> 检查内存中是否已存在语言数据。</li><li><strong>动态加载</strong>： <ul><li>如果内存中<strong>无数据</strong>：根据目标语言，动态 import 对应的语言包文件（例如 <code>@techui/locales/cn</code>）。</li><li>如果内存中<strong>有数据</strong>（通常是因为手动引入了语言包）：则跳过动态加载，直接使用已存在的数据。</li></ul></li><li><strong>状态挂载</strong>：将最终的语言数据挂载到全局响应式状态 <code>$tState.locale</code> 中，供组件使用。</li></ol><h3 id="代码示例" tabindex="-1">代码示例 <a class="header-anchor" href="#代码示例" aria-label="Permalink to &quot;代码示例&quot;">​</a></h3><p>通常情况下，您只需正常初始化 TechUI 即可，无需额外代码：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// main.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TechUIInit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;techui-prime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... 其他配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 内部会自动调用 initI18n()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TechUIInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params);</span></span></code></pre></div><h2 id="手动引入" tabindex="-1">手动引入 <a class="header-anchor" href="#手动引入" aria-label="Permalink to &quot;手动引入&quot;">​</a></h2><p>在某些特定场景下（例如内网环境无法使用动态导入，或者需要将特定语言包打包进主 bundle），您可以在入口文件中显式引入语言包。</p><p><strong>机制</strong>： 当您显式 <code>import</code> 一个语言包时，该文件内部会自动调用 <code>tLang.register</code> 将数据注册到内存中。<code>initI18n</code> 检测到数据已存在，便不会再发起网络请求。</p><p><strong>使用示例</strong>：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// main.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 强制引入英文包，不再自动侦测</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@techui/locales/en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TechUIInit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;techui-prime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 初始化时将直接使用上方引入的英文数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TechUIInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span></code></pre></div><p><strong>注意</strong>：手动引入会增加主包（Bundle）的体积。除非必要，建议使用默认的异步加载方式。</p><h2 id="语言锁定与持久化" tabindex="-1">语言锁定与持久化 <a class="header-anchor" href="#语言锁定与持久化" aria-label="Permalink to &quot;语言锁定与持久化&quot;">​</a></h2><p>TechUI 提供了配套的工具函数来处理用户的主动语言切换和偏好记忆。</p><h3 id="锁定语言-locklang" tabindex="-1">锁定语言 (lockLang) <a class="header-anchor" href="#锁定语言-locklang" aria-label="Permalink to &quot;锁定语言 (lockLang)&quot;">​</a></h3><p>当用户在界面上切换语言时，应调用 <code>lockLang</code> 函数。该函数会将选定的语言代码（如 <code>&#39;en&#39;</code>）写入浏览器的 LocalStorage 中。</p><p><strong>函数签名</strong>：<code>lockLang(lang: &#39;cn&#39; | &#39;hk&#39; | &#39;en&#39;)</code></p><h3 id="获取系统语言-getsyslang" tabindex="-1">获取系统语言 (getSysLang) <a class="header-anchor" href="#获取系统语言-getsyslang" aria-label="Permalink to &quot;获取系统语言 (getSysLang)&quot;">​</a></h3><p>在初始化时，系统使用此函数决定加载哪种语言。其判断优先级为：</p><ol><li><strong>LocalStorage</strong>：检查是否有 <code>lockLang</code> 写入的记录。</li><li><strong>Navigator</strong>：检查浏览器的 <code>navigator.language</code>。</li><li><strong>Default</strong>：默认返回 <code>&#39;cn&#39;</code>。</li></ol><h3 id="完整切换逻辑" tabindex="-1">完整切换逻辑 <a class="header-anchor" href="#完整切换逻辑" aria-label="Permalink to &quot;完整切换逻辑&quot;">​</a></h3><p>由于 TechUI 不支持多语言热重载，标准的切换流程是：<strong>锁定语言 -&gt; 刷新页面</strong>。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { lockLang } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@techui/utils&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleLanguageChange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">langCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. 将用户选择写入本地存储</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  lockLang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(langCode);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. 刷新页面，触发 initI18n 重新读取配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    location.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>通过这种方式，当页面刷新后，<code>initI18n</code> 会通过 <code>getSysLang</code> 读到最新的本地配置，从而加载用户选定的语言包。</p>`,26)])])}const g=i(l,[["render",e]]);export{c as __pageData,g as default};
