import{_ as e,c as t,o as i,aj as n}from"./chunks/framework.DPdjieCD.js";const m=JSON.parse('{"title":"许可证解密流程","description":"","frontmatter":{},"headers":[],"relativePath":"cn/wasm/principle/decode.md","filePath":"cn/wasm/principle/decode.md"}'),r={name:"cn/wasm/principle/decode.md"};function s(a,o,l,c,g,p){return i(),t("div",null,[...o[0]||(o[0]=[n('<h1 id="许可证解密流程" tabindex="-1">许可证解密流程 <a class="header-anchor" href="#许可证解密流程" aria-label="Permalink to &quot;许可证解密流程&quot;">​</a></h1><p>TechUI 的授权验证体系建立在“零信任”与“完全离线”的基础上。所有解密与校验逻辑均在 WebAssembly (Wasm) 的沙箱环境中执行，确保了即使在浏览器端，授权逻辑也难以被篡改或绕过。</p><p>根据组件库等级的不同，TechUI 采用了两套不同的解密策略。</p><h2 id="重许可解密流程" tabindex="-1">重许可解密流程 <a class="header-anchor" href="#重许可解密流程" aria-label="Permalink to &quot;重许可解密流程&quot;">​</a></h2><p><strong>适用组件</strong>：💎 <code>@techui/prime</code> (旗舰版)</p><p>Prime 旗舰版采用了高强度的<strong>双因子解密机制 (Two-Factor Decryption)</strong>。它依赖于一个公开的 Npm 密钥包与一个私有的 Client Key 共同协作，就像银行保险箱需要两把钥匙才能开启。</p><h3 id="核心构成-composition" tabindex="-1">核心构成 (Composition) <a class="header-anchor" href="#核心构成-composition" aria-label="Permalink to &quot;核心构成 (Composition)&quot;">​</a></h3><ol><li><strong>🔑 Npm 钥匙串 (Keychain Package)</strong><ul><li><strong>形式</strong>：以 npm 依赖包形式发布（如 <code>@techui/prime-keychain</code>）。</li><li><strong>内容</strong>：包含了大量混淆后的公钥片段。它是版本化的，随组件库更新而更新。</li></ul></li><li><strong>🆔 Client 身份凭证 (Identity Key)</strong><ul><li><strong>形式</strong>：加密字符串，由 TechUI 商务发放。</li><li><strong>内容</strong>：仅包含客户身份基础信息（公司名、类型、有效期、地区等）。<strong>不含具体权限配置</strong>。</li></ul></li><li><strong>⚙️ 配置参数密钥 (Config Key)</strong><ul><li><strong>形式</strong>：加密字符串，随 Client Key 一并下发。</li><li><strong>内容</strong>：包含详细的权限控制参数（项目绑定规则、子许可信息、功能开关等）。</li></ul></li></ol><h3 id="解密步骤-decryption-steps" tabindex="-1">解密步骤 (Decryption Steps) <a class="header-anchor" href="#解密步骤-decryption-steps" aria-label="Permalink to &quot;解密步骤 (Decryption Steps)&quot;">​</a></h3><p>Wasm 模块在初始化时，严格遵循以下 <strong>7 步闭环流程</strong>：</p><ol><li><strong>提取指纹</strong>：Wasm 读取传入的 <code>Client Key</code>，提取其中的 Key ID。</li><li><strong>定位公钥</strong>：根据提取的 ID，在引入的 <code>@techui/prime-keychain</code> 内存段中查找匹配的 <strong>Npm 密钥</strong>。</li><li><strong>第一层解密</strong>：Wasm 内部算法对 Npm 密钥进行自举解密，获得解密用的“私钥种子”。</li><li><strong>身份解锁</strong>：使用“私钥种子”对用户的 <code>Client Key</code> 进行解密，验证签名合法性。</li><li><strong>基础信息提取</strong>：获取许可证的基础元数据（如 <code>company</code>, <code>region</code>, <code>expDate</code>）。</li><li><strong>第二层解密 (配置加载)</strong>：结合上述所有解密结果，对 <strong>配置参数密钥 (Config Key)</strong> 进行最终解密，获取详细的控制参数（JSON 结构）。</li><li><strong>终极校验</strong>：根据解密出的全量参数，结合当前运行环境（域名、时间、项目名），输出最终的 <code>Boolean</code> 验证结果。</li></ol><h2 id="轻许可解密流程" tabindex="-1">轻许可解密流程 <a class="header-anchor" href="#轻许可解密流程" aria-label="Permalink to &quot;轻许可解密流程&quot;">​</a></h2><p><strong>适用组件</strong>：🚀 Scifi / 📊 Base / 🎛️ Admin</p><p>为了追求极致的易用性与分发效率，轻量级组件采用了<strong>单向解密机制</strong>。</p><h3 id="核心构成-composition-1" tabindex="-1">核心构成 (Composition) <a class="header-anchor" href="#核心构成-composition-1" aria-label="Permalink to &quot;核心构成 (Composition)&quot;">​</a></h3><ul><li><strong>单一许可证串 (Single License String)</strong><ul><li><strong>形式</strong>：一个长字符串。</li><li><strong>内容</strong>：通过高强度压缩与加密，将“身份信息”与“配置参数”打包在一起。</li></ul></li><li>如果是商业许可证的分发场景，还附带了一个<strong>子许可证密钥串</strong>。</li></ul><h3 id="解密步骤-decryption-steps-1" tabindex="-1">解密步骤 (Decryption Steps) <a class="header-anchor" href="#解密步骤-decryption-steps-1" aria-label="Permalink to &quot;解密步骤 (Decryption Steps)&quot;">​</a></h3><ol><li><strong>主许可解密</strong>：Wasm 直接使用内置算法解密主字符串，获取当前主体的授权信息。</li><li><strong>子许解密 (仅商业许可证)</strong>：若检测到该许可证属于“商业许可证 (Commerce)”且包含 <code>subLicense</code> 字段，Wasm 会获取子许可证密钥解密，验证最终客户的授权状态。</li><li><strong>环境校验</strong>：对比解密出的参数（如域名绑定、有效期）与当前运行环境，判定是否放行。</li></ol>',18)])])}const h=e(r,[["render",s]]);export{m as __pageData,h as default};
