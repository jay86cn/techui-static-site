import{_ as i,o as a,c as t,ah as n}from"./chunks/framework.PKn7PQPU.js";const E=JSON.parse('{"title":"拖拽指令","description":"","frontmatter":{},"headers":[],"relativePath":"cn/_common/directive/drag.md","filePath":"cn/_common/directive/drag.md"}'),l={name:"cn/_common/directive/drag.md"};function e(h,s,d,p,k,r){return a(),t("div",null,[...s[0]||(s[0]=[n(`<h1 id="拖拽指令" tabindex="-1">拖拽指令 <a class="header-anchor" href="#拖拽指令" aria-label="Permalink to &quot;拖拽指令&quot;">​</a></h1><p><code>v-tui-drag</code> 是 TechUI 的通用拖拽增强指令。它允许开发者通过配置对象，将任意 DOM 元素变为可拖拽状态。该指令不仅支持常规的绝对定位拖拽，还深度优化了 <code>transform</code> 性能模式，并内置了针对大屏缩放场景（Adaptive）的坐标修正逻辑。</p><h2 id="核心特性" tabindex="-1">核心特性 <a class="header-anchor" href="#核心特性" aria-label="Permalink to &quot;核心特性&quot;">​</a></h2><ul><li><strong>双模式定位</strong>：支持 <code>transform</code> (GPU加速，默认) 和 <code>style.left/top</code> (绝对定位) 两种移动模式。</li><li><strong>精细控制</strong>：支持指定拖拽句柄 (<code>trigger</code>) 和排除区域 (<code>exclude</code>)。</li><li><strong>边界约束</strong>：可自动限制元素在父容器范围内移动 (<code>containment</code>)。</li><li><strong>缩放适配</strong>：内置 <code>inAdpt</code> 参数，解决在大屏 <code>scale</code> 缩放模式下鼠标位移与元素移动不同步的问题。</li></ul><h2 id="基础用法" tabindex="-1">基础用法 <a class="header-anchor" href="#基础用法" aria-label="Permalink to &quot;基础用法&quot;">​</a></h2><p>最简单的用法是直接绑定指令，默认开启 <code>containment</code> 且使用 <code>transform</code> 移动。</p><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;box&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v-tui-drag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Drag Me</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="api-参考" tabindex="-1">API 参考 <a class="header-anchor" href="#api-参考" aria-label="Permalink to &quot;API 参考&quot;">​</a></h2><p><code>v-tui-drag</code> 接收一个对象作为参数，支持以下配置项：</p><table tabindex="0"><thead><tr><th>参数名</th><th>说明</th><th>类型</th><th>默认值</th></tr></thead><tbody><tr><td><strong>enabled</strong></td><td><strong>启用开关</strong>。控制是否允许拖拽，动态切换时会自动处理光标样式。</td><td><code>Boolean</code></td><td><code>true</code></td></tr><tr><td><strong>trigger</strong></td><td><strong>拖拽句柄</strong>。CSS 选择器字符串。仅当鼠标在指定子元素上按下时才触发拖拽（例如：只允许按住标题栏拖动）。</td><td><code>String</code></td><td><code>el</code> (自身)</td></tr><tr><td><strong>exclude</strong></td><td><strong>排除区域</strong>。CSS 选择器字符串。位于 trigger 内部但<strong>不触发</strong>拖拽的元素（例如：标题栏上的关闭按钮）。</td><td><code>String</code></td><td>—</td></tr><tr><td><strong>containment</strong></td><td><strong>边界限制</strong>。是否将元素限制在父容器可视范围内。</td><td><code>Boolean</code></td><td><code>true</code></td></tr><tr><td><strong>positionType</strong></td><td><strong>定位模式</strong>。可选 <code>&#39;transform&#39;</code> 或 <code>&#39;absolute&#39;</code>/<code>&#39;fixed&#39;</code>。<br><code>&#39;transform&#39;</code>: 修改 CSS Translate，性能更好，不破坏文档流。<br><code>&#39;absolute&#39;</code>: 修改 left/top，适用于传统的定位布局。</td><td><code>String</code></td><td><code>&#39;transform&#39;</code></td></tr><tr><td><strong>inAdpt</strong></td><td><strong>缩放修正</strong>。是否处于 TechUI 的缩放适配容器中。开启后会根据全局 <code>tDom.adpt.info</code> 修正鼠标坐标，防止拖拽漂移。</td><td><code>Boolean</code></td><td><code>false</code></td></tr><tr><td><strong>resetOnDisable</strong></td><td><strong>禁用重置</strong>。当 <code>enabled</code> 变为 <code>false</code> 时，是否清空元素的 <code>style</code> 属性（如重置位置）。</td><td><code>Boolean</code></td><td><code>false</code></td></tr><tr><td><strong>uid</strong></td><td><strong>事件标识</strong>。用于区分不同的事件监听器，建议在复杂场景传入唯一 ID。</td><td><code>String</code></td><td>—</td></tr></tbody></table><h2 id="典型案例" tabindex="-1">典型案例 <a class="header-anchor" href="#典型案例" aria-label="Permalink to &quot;典型案例&quot;">​</a></h2><p>以下是TechUI组件库中使用v-tui-drag指令的典型案例。</p><h3 id="弹窗组件-dialog" tabindex="-1">弹窗组件 (Dialog) <a class="header-anchor" href="#弹窗组件-dialog" aria-label="Permalink to &quot;弹窗组件 (Dialog)&quot;">​</a></h3><p>这是最经典的使用场景。通常我们希望：</p><ul><li>用户只能按住 <strong>标题栏 (<code>.dialog-header</code>)</strong> 拖动。</li><li>点击 <strong>关闭按钮 (<code>.dialog-close</code>)</strong> 时不会触发拖拽。</li><li>全屏模式 (<code>fullscreen</code>) 下禁止拖拽。</li><li>限制弹窗不能拖出可视区域。</li></ul><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dialog-inner&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    v-tui-drag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      enabled: draggable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fullscreen, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 全屏或配置不可拖拽时禁用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      trigger: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.dialog-header&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 仅标题栏可拖动</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      exclude: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.dialog-close&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 排除关闭按钮，防止误触</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      containment: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 限制在父容器内</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      positionType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;absolute&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用绝对定位模式 (配合 dialog 的 CSS)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      inAdpt: isInsideAdaptiveBox,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如果在缩放容器内，需开启修正</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      uid: uniqueId</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dialog-header&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Title&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dialog-close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;X&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dialog-content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;...&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="全局适配容器-adaptive-container" tabindex="-1">全局适配容器 (Adaptive Container) <a class="header-anchor" href="#全局适配容器-adaptive-container" aria-label="Permalink to &quot;全局适配容器 (Adaptive Container)&quot;">​</a></h3><p>在数据大屏或编辑器场景中，可能需要拖动整个画板。</p><ul><li>这里使用 <code>positionType: &#39;transform&#39;</code> 以获得最佳渲染性能。</li><li>开启 <code>resetOnDisable: true</code>，以便在锁定画板时自动复位。</li></ul><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tuiAdptOuter&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    v-tui-drag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      enabled: state.dragable,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 由状态控制是否可拖动</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      trigger: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;#tuiAdpt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 整个区域作为句柄</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      resetOnDisable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 禁用时重置 transform 位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      containment: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 不限制边界，允许拖出视野</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      positionType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;transform&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 GPU 加速移动</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      inAdpt: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 自身就是适配层，无需再次修正</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      uid: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;adpt-drag-001&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="技术细节" tabindex="-1">技术细节 <a class="header-anchor" href="#技术细节" aria-label="Permalink to &quot;技术细节&quot;">​</a></h2><h3 id="坐标计算逻辑" tabindex="-1">坐标计算逻辑 <a class="header-anchor" href="#坐标计算逻辑" aria-label="Permalink to &quot;坐标计算逻辑&quot;">​</a></h3><p>指令内部通过 <code>drag.js</code> 实现了复杂的坐标计算：</p><ol><li><strong>初始位置获取</strong> (<code>getStartPosition</code>):</li></ol><ul><li><strong>Transform 模式</strong>: 解析 <code>window.getComputedStyle(el).transform</code> 矩阵 (<code>DOMMatrix</code>) 获取当前的 translate X/Y。</li><li><strong>Position 模式</strong>: 计算 <code>el.getBoundingClientRect()</code> 相对于 <code>offsetParent</code> 的偏移量。</li></ul><ol start="2"><li><strong>移动增量</strong>: 计算 <code>e.clientX - mouseStartX</code>。如果开启了 <code>inAdpt</code>，增量会除以全局缩放比例 (<code>scaleX</code>, <code>scaleY</code>)，从而保证在缩放页面中鼠标跟手。</li><li><strong>边界碰撞</strong> (<code>containCalcTrans</code>/<code>containCalcPos</code>): 预先计算最小和最大允许的 X/Y 值，在 <code>mousemove</code> 时进行数值钳制 (Clamp)。</li></ol>`,26)])])}const g=i(l,[["render",e]]);export{E as __pageData,g as default};
